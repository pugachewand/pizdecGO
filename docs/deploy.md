## Модель ветвления
- Общая идея описана [здесь](https://habr.com/ru/post/106912/)
- Мастер - прод-ветка, все новые фишки форкаем от дева. После успешного ревью вливаем в дев (с флагом no-ff или на МРке ставим squash, чтобы не плодить коммиты)
- Когда надо отдать на тестирование потенциальный релиз, сравниваем dev и master, в `release_notes_beta.yml` отписываем, что изменилось, форкаемся от дева `git checkout -b rc/<YYYY-MM-dd>-<release-number>`, например `rc/2020-01-02-01`, отправляем эту ветку в гитлаб. Префикс `rc/` обязателен, по нему Fastlane формирует по-другому название релиза. Все проблемы, которые были найдены при тестировании фиксим в этой ветке. В дев можем эти изменения мёрджить, но должны быть две отдельные ветки, чтобы новые фичи, влитые в дев не затрагивали релиз кандидата, и чтобы тестировщику не приходилось начинать свою работу сначала.
- После утверждения кандидата тестировщиком вливаем `rc`-ветку в мастер.
- Если требуется накатить хотфикс на уже опубликованную в прод версию, форкаем от мастера ветку с таким же префиксом `rc/`, даём тестировщику на проверку, потом вливаем в мастер.
- По мере обновления мастера и `rc`-веток не забываем изменения из них вливать в `dev`, чтобы не копить разработчикам конфликты слияния.


## Fastlane
### Настройка
- Настроек и нюансов очень много, все не перечислишь. Но некоторые важные вещи, тем не менее, лучше задокументировать
- Если сделанный через `match` провижн профиль ругается на отсутствие каких-либо возможностей (пуш-уведомления, платежи и иже с ними), во-первых, надо проверить наличие галки в сборке в xCode, во-вторых, установить эту галку в настройках сертификата в ЛК в App Store.
- Во всех матчах, билдах и паблишах bundle-id приложения лучше прописывать явно. Брать их из match-файла не очень очевидно.
- Переменные окружение `IOS_AUTH_USER_EMAIL` и `FASTLANE_PASSWORD` это логин и пароль от айклауда. Учётка от айклауда должна быть старая, без двухфакторной аутентификации. Иначе с ума сойдёшь обновлять ключ сессии. Сертификаты и провижны желательно генерить от этой же учётки.
- В `before_all` обязательно вызываем `setup_ci`. В противном случае билд будет проходить или очень долго, или затребует участия пользователя и вылетит по таймауту.


### Запуск
* В пайплайне можно зайти в настройки и установить переменные
    * `SKIP_ANDROID`, `SKIP_IOS`, `SKIP_FIREBASE_INIT` - Пропускает билд для iOS, Android, инициализацию Firebase, соответственно.
    * `DRY_RUN` - запускает fastlane, но но пропускает всё, связанное с билдом
	 * `SKIP_VALIDATION` - пропускает запуск компилятора, линтера и тестов. Удобно для тестовых билдов. На проде игнорировать нельзя.

* Возможно, мне кажется, но билд на MacOS 10.14 проходит быстрее и с меньшими проблемами, чем на 10.15
* Постфикс релиза в FireBase по умолчанию `-dev`. Если название ветки начинается с `rc`, то постфикс будет `rc`. Строится бета или отправляется релиз в прод, Fastlane также определяет автоматом по названию ветки. `master` - прод, остальные - бета.


